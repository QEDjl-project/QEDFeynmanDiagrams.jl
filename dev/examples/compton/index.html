<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Compton · QEDFeynmanDiagrams.jl</title><meta name="title" content="Compton · QEDFeynmanDiagrams.jl"/><meta property="og:title" content="Compton · QEDFeynmanDiagrams.jl"/><meta property="twitter:title" content="Compton · QEDFeynmanDiagrams.jl"/><meta name="description" content="Documentation for QEDFeynmanDiagrams.jl."/><meta property="og:description" content="Documentation for QEDFeynmanDiagrams.jl."/><meta property="twitter:description" content="Documentation for QEDFeynmanDiagrams.jl."/><meta property="og:url" content="https://QEDjl-project.github.io/QEDFeynmanDiagrams.jl/examples/compton/"/><meta property="twitter:url" content="https://QEDjl-project.github.io/QEDFeynmanDiagrams.jl/examples/compton/"/><link rel="canonical" href="https://QEDjl-project.github.io/QEDFeynmanDiagrams.jl/examples/compton/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">QEDFeynmanDiagrams.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">QEDFeynmanDiagrams.jl</a></li><li><a class="tocitem" href="../../manual/">Manual</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../trident/">Trident</a></li><li class="is-active"><a class="tocitem" href>Compton</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/public/">Public</a></li><li><a class="tocitem" href="../../lib/internal/">Internal</a></li></ul></li><li><a class="tocitem" href="../../contribution/">Contribution</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Compton</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Compton</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QEDFeynmanDiagrams/QEDFeynmanDiagrams.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QEDFeynmanDiagrams/QEDFeynmanDiagrams.jl/blob/dev/docs/src/examples/compton.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="n-Photon-Compton-Scattering-Process"><a class="docs-heading-anchor" href="#n-Photon-Compton-Scattering-Process">n-Photon Compton Scattering Process</a><a id="n-Photon-Compton-Scattering-Process-1"></a><a class="docs-heading-anchor-permalink" href="#n-Photon-Compton-Scattering-Process" title="Permalink"></a></h1><p>In this file, we set up an n-photon Compton scattering process. A Compton scattering process looks like <span>$k^n e^- \to k e^-$</span>.</p><p>You can download this file as a <a href="../compton.ipynb">jupyter notebook</a>.</p><pre><code class="language-julia hljs">using QEDFeynmanDiagrams</code></pre><p>We need some of the packages of the <a href="https://github.com/QEDjl-project">QEDjl-project</a> for base functionality and the <code>ScatteringProcess</code> type.</p><pre><code class="language-julia hljs">using QEDcore
using QEDprocesses</code></pre><p>Let&#39;s decide how many photons our electron interacts with:</p><pre><code class="language-julia hljs">n = 4;</code></pre><p>Now we setup the scattering process accordingly. We consider all spin/polarization combinations of the particles except for the incoming photons.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The functionality is not quite ready yet, but in the future, the incoming photons can be synced using <code>SyncedPol</code> from QEDbase. This would emulate all incoming photons having the same polarization, for example from a laser.</p></div></div><pre><code class="language-julia hljs">proc = ScatteringProcess(
    (Electron(), ntuple(_ -&gt; Photon(), n)...),  # incoming particles
    (Electron(), Photon()),                     # outgoing particles
    (AllSpin(), ntuple(_ -&gt; PolX(), n)...),     # incoming particle spin/pols
    (AllSpin(), AllPol()),                      # outgoing particle spin/pols
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">generic QED process
    incoming: electron (all spins), photon (x-polarized), photon (x-polarized), photon (x-polarized), photon (x-polarized)
    outgoing: electron (all spins), photon (all polarizations)
</code></pre><p>The <a href="../../lib/public/#QEDFeynmanDiagrams.feynman_diagrams"><code>feynman_diagrams</code></a> function returns an iterator for all possible Feynman diagrams for this scattering process. With its <code>length</code> overload, we can check how many diagrams there are. For an n-photon Compton process with <code>n</code> incoming photons, this should be <span>$(n+1)!$</span>.</p><pre><code class="language-julia hljs">length(feynman_diagrams(proc))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">120</code></pre><p>Next, we can generate the DAG representing the computation for our scattering process&#39; squared matrix element. This uses <a href="https://github.com/ComputableDAGs/ComputableDAGs.jl"><code>ComputableDAGs.jl</code></a>.</p><pre><code class="language-julia hljs">dag = generate_DAG(proc)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Graph:
  Nodes: Total: 1210, QEDFeynmanDiagrams.ComputeTask_CollectTriples: 8, QEDFeynmanDiagrams.ComputeTask_CollectPairs: 80, 
         QEDFeynmanDiagrams.ComputeTask_Triple: 240, QEDFeynmanDiagrams.ComputeTask_SpinPolCumulation: 1, QEDFeynmanDiagrams.ComputeTask_Pair: 136, 
         ComputableDAGs.DataTask: 625, QEDFeynmanDiagrams.ComputeTask_Propagator: 30, QEDFeynmanDiagrams.ComputeTask_PropagatePairs: 80, 
         QEDFeynmanDiagrams.ComputeTask_BaseState: 10
  Edges: 2161
  Total Compute Effort: 0.0
  Total Data Transfer: 0.0
  Total Compute Intensity: 0.0
</code></pre><p>In this graph output you can see the number of nodes necessary to compute. Note that for larger processes, the number of total nodes can be <em>lower</em> than the number of Feynman diagrams, even with the added complexity of considering multiple spin and polarization combinations. This is the result of efficient reuse of reappearing parts of Feynman diagrams.</p><p>To continue, we will need <a href="https://github.com/ComputableDAGs/ComputableDAGs.jl"><code>ComputableDAGs.jl</code></a>. Since <code>ComputableDAGs.jl</code> uses <code>RuntimeGeneratedFunction</code>s as the return type of <a href="https://computabledags.github.io/ComputableDAGs.jl/dev/lib/internals/code_gen/#ComputableDAGs.get_compute_function-Tuple%7BDAG%2C%20Any%2C%20Machine%2C%20Module%7D"><code>ComputableDAGs.get_compute_function</code></a>, we need to initialize it in our current module.</p><pre><code class="language-julia hljs">using ComputableDAGs
using RuntimeGeneratedFunctions
RuntimeGeneratedFunctions.init(@__MODULE__)</code></pre><p>With the DAG, the process, and <code>RuntimeGeneratedFunctions</code> initalized, we can now generate the actual computable function:</p><pre><code class="language-julia hljs">func = get_compute_function(dag, proc, cpu_st(), @__MODULE__);</code></pre><p>Now we need an input for the function, which is a <a href="https://qedjl-project.github.io/QEDcore.jl/dev/#QEDcore.PhaseSpacePoint"><code>QEDcore.PhaseSpacePoint</code></a>. For now, we generate random momenta for every particle. In the future, QEDevents will be able to generate physical <code>PhaseSpacePoint</code>s.</p><pre><code class="language-julia hljs">psp = PhaseSpacePoint(
    proc,
    PerturbativeQED(),
    PhasespaceDefinition(SphericalCoordinateSystem(), ElectronRestFrame()),
    tuple((rand(SFourMomentum) for _ in 1:number_incoming_particles(proc))...),
    tuple((rand(SFourMomentum) for _ in 1:number_outgoing_particles(proc))...),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PhaseSpacePoint:
    process: generic QED process &quot;ekkkk -&gt; ek&quot;
    model: perturbative QED
    phasespace definition: spherical coordinates in electron rest frame
    incoming particles:
     -&gt; incoming electron: [0.4542565057557014, 0.3317494952135611, 0.24014548665104418, 0.16281302449936852]
     -&gt; incoming photon: [0.39444664374043426, 0.7863406794612541, 0.6587537139080007, 0.7970343626586276]
     -&gt; incoming photon: [0.42033689857907064, 0.6622164484128634, 0.45132582053535963, 0.45223717851495415]
     -&gt; incoming photon: [0.7525600709887128, 0.3645132372689528, 0.27005950709555127, 0.4435358114637571]
     -&gt; incoming photon: [0.34059209087241205, 0.7551464537416149, 0.4317712476359108, 0.6873435443710869]
    outgoing particles:
     -&gt; outgoing electron: [0.2897636319432393, 0.15625365902233868, 0.42829721133820586, 0.9590770982050523]
     -&gt; outgoing photon: [0.34210717233796784, 0.6501988503284051, 0.41226714347350346, 0.8469610801205094]
</code></pre><p>Finally, we can test that the function actually runs and computes something by simply calling it on the <code>PhaseSpacePoint</code>:</p><pre><code class="language-julia hljs">func(psp)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.0028773082203958963</code></pre><p>If we want, we can benchmark the execution speed too:</p><pre><code class="language-julia hljs">using BenchmarkTools
@benchmark func($psp)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> … <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">46.146 μs</span></span> … <span class="sgr35">180.972 ms</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>min … max<span class="sgr90">): </span> 0.00% … 99.92%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">50.454 μs               </span></span><span class="sgr90">┊</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span> 0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> ± <span class="sgr32">σ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">80.706 μs</span></span> ± <span class="sgr32">  1.810 ms</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>mean ± σ<span class="sgr90">):  </span>23.81% ±  2.38%

    ▁██▂<span class="sgr34"> </span>                                             <span class="sgr32"> </span>         
  ▁▃████<span class="sgr34">▆</span>▃▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▂▃▄█▇▇▇▅▄▃▂<span class="sgr32">▂</span>▁▁▁▁▁▁▁ ▂
  46.1 μs<span class="sgr90">         Histogram: frequency by time</span>         86.3 μs <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">74.09 KiB</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">606</span>.</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../trident/">« Trident</a><a class="docs-footer-nextpage" href="../../lib/public/">Public »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 11 September 2024 12:54">Wednesday 11 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
